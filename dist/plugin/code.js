"use strict";const M=["BOOLEAN_OPERATION","COMPONENT","ELLIPSE","FRAME","INSTANCE","LINE","POLYGON","RECTANGLE","STAR","TEXT","VECTOR","SHAPE_WITH_TEXT","HIGHLIGHT"];function R(){var g,c;const e=figma.currentPage.selection,o={newColorsRgba:{fill:null,stroke:null},uiMessageCode:null,nodeType:null};if(!e[0])return o.uiMessageCode="no_selection",o;for(const C of e)if(!M.includes(C.type))return o.uiMessageCode="not_supported_type",o.nodeType=C.type,o;const s=e[0].fills[0],t=e[0].strokes[0];if(!s&&!t)return o.uiMessageCode="no_color_in_shape",o;if((s==null?void 0:s.type)!=="SOLID"&&(t==null?void 0:t.type)!=="SOLID")return o.uiMessageCode="no_solid_color",o;if((s==null?void 0:s.type)==="SOLID"&&(o.newColorsRgba.fill={r:s.color.r*255,g:s.color.g*255,b:s.color.b*255,a:Math.round(s.opacity*100)}),(t==null?void 0:t.type)==="SOLID"&&(o.newColorsRgba.stroke={r:t.color.r*255,g:t.color.g*255,b:t.color.b*255,a:Math.round(t.opacity*100)}),e.length>1){let C=0,p=0;for(const y of e)((g=y.fills[0])==null?void 0:g.type)==="SOLID"&&C++,((c=y.strokes[0])==null?void 0:c.type)==="SOLID"&&p++;if(e.length!==C&&e.length!==p)return o.uiMessageCode="not_all_shapes_have_fill_or_stroke",o}return o}function O(e,o){const s={r:e.r/255,g:e.g/255,b:e.b/255,a:e.a/100};let t;const g=o+"s";for(const c of figma.currentPage.selection)t=JSON.parse(JSON.stringify(c[g])),t[0].color.r=s.r,t[0].color.g=s.g,t[0].color.b=s.b,t[0].opacity=s.a,c[g]=t}function f(e){const{messageType:o,messageData:s}=e;switch(o){case"init":figma.ui.postMessage({message:o,initData:s});break;case"newColorsRgba":figma.ui.postMessage({message:o,newColorsRgbaData:s});break;case"displayUiMessage":figma.ui.postMessage({message:o,displayUiMessageData:s});break}}let i="fill",d,n,S,l;const r={okHsvlWithoutColorCodes:436,okHsvlWithColorCodes:564,okLchWithoutColorCodes:469,okLchWithColorCodes:598};let h=!1,a={fill:null,stroke:null};const E=["fills","fillStyleId","strokes","strokeWeight"],k=()=>{l?["oklch","oklchCss"].includes(n)?figma.ui.resize(240,r.okLchWithColorCodes):figma.ui.resize(240,r.okHsvlWithColorCodes):["oklch","oklchCss"].includes(n)?figma.ui.resize(240,r.okLchWithoutColorCodes):figma.ui.resize(240,r.okHsvlWithoutColorCodes)},m=()=>{const e=R();return e.uiMessageCode?(f({messageType:"displayUiMessage",messageData:{uiMessageCode:e.uiMessageCode,nodeType:e.nodeType}}),"uiMessageCode sent"):(a=JSON.parse(JSON.stringify(e.newColorsRgba)),"colorsRgba updated")},I=async()=>{figma.editorType==="figma"?d=await figma.clientStorage.getAsync("fileColorProfile")||"rgb":figma.editorType==="figjam"&&(d="rgb"),n=await figma.clientStorage.getAsync("currentColorModel")||"oklchCss",S=await figma.clientStorage.getAsync("lockRelativeChroma")||!1,l=await figma.clientStorage.getAsync("showCssColorCodes")||!1;let e=l?r.okLchWithColorCodes:r.okLchWithoutColorCodes;["okhsv","okhsl"].includes(n)&&(e=l?r.okHsvlWithColorCodes:r.okHsvlWithoutColorCodes),figma.showUI(__html__,{width:240,height:e,themeColors:!0})};I();const _=async()=>{f({messageType:"init",messageData:{figmaEditorType:figma.editorType,fileColorProfile:d,currentColorModel:n,lockRelativeChroma:S,showCssColorCodes:l}}),m()!=="uiMessageCode sent"&&(i=a.fill?"fill":"stroke",f({messageType:"newColorsRgba",messageData:{colorsRgba:a,currentFillOrStroke:i}}))},b=()=>{m()!=="uiMessageCode sent"&&(i=a.fill?"fill":"stroke",f({messageType:"newColorsRgba",messageData:{colorsRgba:a,currentFillOrStroke:i}}))},T=e=>{if(h||e.documentChanges[0].type!=="PROPERTY_CHANGE")return;const o=e.documentChanges[0].properties[0];if(E.includes(o)){const s=JSON.parse(JSON.stringify(a));if(m()==="uiMessageCode sent")return;JSON.stringify(s)!==JSON.stringify(a)&&(i==="fill"&&!a.fill?i="stroke":i==="stroke"&&!a.stroke&&(i="fill")),f({messageType:"newColorsRgba",messageData:{colorsRgba:a,currentFillOrStroke:i}})}};figma.on("selectionchange",b);figma.on("documentchange",T);figma.on("close",()=>{figma.off("selectionchange",b),figma.off("documentchange",T)});let u;figma.ui.onmessage=e=>{switch(e.message){case"init":_();break;case"updateShapeColor":h=!0,O(e.newColorRgba,i),u&&clearTimeout(u),u=setTimeout(()=>{h=!1},500);break;case"syncFileColorProfile":figma.clientStorage.setAsync("fileColorProfile",e.fileColorProfile);break;case"syncCurrentFillOrStroke":i=e.currentFillOrStroke;break;case"syncCurrentColorModel":n=e.currentColorModel,k(),figma.clientStorage.setAsync("currentColorModel",e.currentColorModel);break;case"syncShowCssColorCodes":l=e.showCssColorCodes,k(),figma.clientStorage.setAsync("showCssColorCodes",l);break;case"syncLockRelativeChromaWithPlugin":figma.clientStorage.setAsync("lockRelativeChroma",e.lockRelativeChroma);break}};
