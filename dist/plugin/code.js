"use strict";let r="fill",y,i,I,c;const g={okHslvWithoutColorCodes:436,okHslvWithColorCodes:564,okLchWithoutColorCodes:469,okLchWithColorCodes:598};let S=!1,o={hasFillStroke:{fill:!1,stroke:!1},colors:{fill:{rgba:[255,255,255,0]},stroke:{rgba:[255,255,255,0]}}};const E=["BOOLEAN_OPERATION","COMPONENT","ELLIPSE","FRAME","INSTANCE","LINE","POLYGON","RECTANGLE","STAR","TEXT","VECTOR","SHAPE_WITH_TEXT","HIGHLIGHT"],O=["fills","fillStyleId","strokes","strokeWeight"],p=function(){c?i==="oklch"||i==="oklchCss"?figma.ui.resize(240,g.okLchWithColorCodes):figma.ui.resize(240,g.okHslvWithColorCodes):i==="oklch"||i==="oklchCss"?figma.ui.resize(240,g.okLchWithoutColorCodes):figma.ui.resize(240,g.okHslvWithoutColorCodes)},P=function(){o.hasFillStroke.fill=!1,o.hasFillStroke.stroke=!1,o.colors.fill.rgba=[255,255,255,0],o.colors.stroke.rgba=[255,255,255,0]},d=function(){var a,u;P();const e=figma.currentPage.selection;if(!e[0])return C("noSelection"),!1;for(const s of e)if(!E.includes(s.type))return C("notSupportedType",s.type),!1;const t=e[0].fills[0],l=e[0].strokes[0];if(!t&&!l)return C("noColorInShape"),!1;if((t==null?void 0:t.type)!=="SOLID"&&(l==null?void 0:l.type)!=="SOLID")return C("noSolidColor"),!1;if((t==null?void 0:t.type)==="SOLID"&&(o.hasFillStroke.fill=!0,o.colors.fill.rgba[0]=t.color.r*255,o.colors.fill.rgba[1]=t.color.g*255,o.colors.fill.rgba[2]=t.color.b*255,o.colors.fill.rgba[3]=Math.round(t.opacity*100)),(l==null?void 0:l.type)==="SOLID"&&(o.hasFillStroke.stroke=!0,o.colors.stroke.rgba[0]=l.color.r*255,o.colors.stroke.rgba[1]=l.color.g*255,o.colors.stroke.rgba[2]=l.color.b*255,o.colors.stroke.rgba[3]=Math.round(l.opacity*100)),e.length>1){let s=0,n=0;for(const f of e)((a=f.fills[0])==null?void 0:a.type)==="SOLID"&&s++,((u=f.strokes[0])==null?void 0:u.type)==="SOLID"&&n++;if(e.length!==s&&e.length!==n)return C("notAllShapesHaveFillOrStroke"),!1;n<s?o.hasFillStroke.stroke=!1:s<n&&(o.hasFillStroke.fill=!1)}return!0},T=function(){figma.ui.postMessage({message:"init",data:{fileColorProfile:y,currentColorModel:i,lockRelativeChroma:I,showCssColorCodes:c}})},h=function(e=!1){figma.ui.postMessage({message:"newShapeColor",shapeInfos:o,currentFillOrStroke:r,shouldRenderColorPickerCanvas:e})},C=function(e,t=""){figma.ui.postMessage({message:"displayUiMessage",UiMessageCode:e,nodeType:t})};figma.on("selectionchange",()=>{r="fill",d()&&(r==="fill"&&!o.hasFillStroke.fill?r="stroke":r==="stroke"&&!o.hasFillStroke.stroke&&(r="fill"),h(!0))});figma.on("documentchange",e=>{if(S)return;if(e.documentChanges[0].type==="PROPERTY_CHANGE"){const l=e.documentChanges[0].properties[0];if(O.includes(l)){let a=Object.assign({},o.hasFillStroke);if(!d())return;if(JSON.stringify(a)!==JSON.stringify(o.hasFillStroke)){r==="fill"&&!o.hasFillStroke.fill?r="stroke":r==="stroke"&&!o.hasFillStroke.stroke&&(r="fill"),h(!0);return}r==="fill"&&l==="strokes"||r==="stroke"&&l==="fills"?h():h(!0)}}});let k;figma.ui.onmessage=e=>{if(e.type==="init")m();else if(e.type==="updateShapeColor"){S=!0;const t=e.newColor[0]/255,l=e.newColor[1]/255,a=e.newColor[2]/255,u=e.newColor[3]/100;let s;const n=r+"s";for(const f of figma.currentPage.selection)n in f&&(s=JSON.parse(JSON.stringify(f[n])),s[0].color.r=t,s[0].color.g=l,s[0].color.b=a,s[0].opacity=u,f[n]=s);k&&clearTimeout(k),k=setTimeout(()=>{S=!1},500)}else e.type==="syncFileColorProfile"?figma.clientStorage.setAsync("fileColorProfile",e.fileColorProfile):e.type==="syncCurrentFillOrStroke"?r=e.currentFillOrStroke:e.type==="syncCurrentColorModel"?(i=e.currentColorModel,p(),figma.clientStorage.setAsync("currentColorModel",e.currentColorModel)):e.type==="syncShowCssColorCodes"?(c=e.showCssColorCodes,p(),figma.clientStorage.setAsync("showCssColorCodes",c)):e.type==="syncLockRelativeChromaWithPlugin"&&figma.clientStorage.setAsync("lockRelativeChroma",e.lockRelativeChroma)};figma.showUI(__html__,{width:240,height:469,themeColors:!0});const m=async function(){y=await figma.clientStorage.getAsync("fileColorProfile")||"rgb",i=await figma.clientStorage.getAsync("currentColorModel"),i!=="okhsv"&&i!=="okhsl"&&i!=="oklch"&&i!=="oklchCss"&&(i="oklchCss"),I=await figma.clientStorage.getAsync("lockRelativeChroma")||!1,c=await figma.clientStorage.getAsync("showCssColorCodes")||!1,c&&figma.ui.resize(240,598),T(),d()&&(o.hasFillStroke.fill?r="fill":r="stroke",h(!0))};
