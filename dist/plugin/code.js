"use strict";const w=["BOOLEAN_OPERATION","COMPONENT","ELLIPSE","FRAME","INSTANCE","LINE","POLYGON","RECTANGLE","STAR","TEXT","VECTOR","SHAPE_WITH_TEXT","HIGHLIGHT"];function I(){var i,C,u,c;const e=figma.currentPage.selection,o={newColorsRgba:{parentFill:null,fill:null,stroke:null},uiMessageCode:null,nodeType:null};if(!e[0])return o.uiMessageCode="no_selection",o;for(const s of e)if(!w.includes(s.type))return o.uiMessageCode="not_supported_type",o.nodeType=s.type,o;const l=e[0].fills[0],t=e[0].strokes[0];if(!l&&!t)return o.uiMessageCode="no_color_in_shape",o;if((l==null?void 0:l.type)!=="SOLID"&&(t==null?void 0:t.type)!=="SOLID")return o.uiMessageCode="no_solid_color",o;if((l==null?void 0:l.type)==="SOLID"&&(o.newColorsRgba.fill={r:l.color.r*255,g:l.color.g*255,b:l.color.b*255,a:Math.round(l.opacity*100)}),(t==null?void 0:t.type)==="SOLID"&&(o.newColorsRgba.stroke={r:t.color.r*255,g:t.color.g*255,b:t.color.b*255,a:Math.round(t.opacity*100)}),(i=e[0].parent)!=null&&i.fills){let s=e[0].parent;for(;s;)if(s.fills&&((C=s==null?void 0:s.fills)==null?void 0:C.length)!==0){o.newColorsRgba.parentFill={r:s.fills[0].color.r*255,g:s.fills[0].color.g*255,b:s.fills[0].color.b*255};break}else if(s.parent)s=s.parent;else break}if(e.length>1){o.newColorsRgba.parentFill&&(o.newColorsRgba.parentFill=null);let s=0,k=0;for(const S of e)((u=S.fills[0])==null?void 0:u.type)==="SOLID"&&s++,((c=S.strokes[0])==null?void 0:c.type)==="SOLID"&&k++;if(e.length!==s&&e.length!==k)return o.uiMessageCode="not_all_shapes_have_fill_or_stroke",o}return o}function E(e,o,l){var u;const t={r:e.r/255,g:e.g/255,b:e.b/255,a:e.a/100};let i;const C=o+"s";for(const c of figma.currentPage.selection){let s;if(l){for(s=c.parent;s&&((u=s.fills)==null?void 0:u.length)===0;)if(s.parent)s=s.parent;else break;i=JSON.parse(JSON.stringify(s.fills))}else i=JSON.parse(JSON.stringify(c[C]));i[0].color.r=t.r,i[0].color.g=t.g,i[0].color.b=t.b,i[0].opacity=t.a,l?s.fills=i:c[C]=i}}function d(e){const{messageType:o,messageData:l}=e;switch(o){case"init":figma.ui.postMessage({message:o,initData:l});break;case"newColorsRgba":figma.ui.postMessage({message:o,newColorsRgbaData:l});break;case"displayUiMessage":figma.ui.postMessage({message:o,displayUiMessageData:l});break}}let a="fill",p,f,g,R,T;const n={okHsvlWithoutColorCodes:435,okHsvlWithColorCodes:564,okLchWithoutColorCodes:503,okLchWithColorCodes:632};let m=!1,r={parentFill:null,fill:null,stroke:null};const _=["fills","fillStyleId","strokes","strokeStyleId","strokeWeight","textStyleId"],b=()=>{g?["oklch","oklchCss"].includes(f)?figma.ui.resize(240,n.okLchWithColorCodes):figma.ui.resize(240,n.okHsvlWithColorCodes):["oklch","oklchCss"].includes(f)?figma.ui.resize(240,n.okLchWithoutColorCodes):figma.ui.resize(240,n.okHsvlWithoutColorCodes)},y=()=>{const e=I();return e.uiMessageCode?(d({messageType:"displayUiMessage",messageData:{uiMessageCode:e.uiMessageCode,nodeType:e.nodeType}}),"uiMessageCode sent"):(r=JSON.parse(JSON.stringify(e.newColorsRgba)),"colorsRgba updated")},P=async()=>{figma.editorType==="figma"?p=await figma.clientStorage.getAsync("fileColorProfile")||"rgb":figma.editorType==="figjam"&&(p="rgb"),f=await figma.clientStorage.getAsync("currentColorModel")||"oklchCss",g=await figma.clientStorage.getAsync("showCssColorCodes")||!1,R=await figma.clientStorage.getAsync("lockRelativeChroma")||!1,T=await figma.clientStorage.getAsync("lockContrast")||!1;let e=g?n.okLchWithColorCodes:n.okLchWithoutColorCodes;["okhsv","okhsl"].includes(f)&&(e=g?n.okHsvlWithColorCodes:n.okHsvlWithoutColorCodes),figma.showUI(__html__,{width:240,height:e,themeColors:!0})};P();const N=async()=>{d({messageType:"init",messageData:{figmaEditorType:figma.editorType,fileColorProfile:p,currentColorModel:f,showCssColorCodes:g,lockRelativeChroma:R,lockContrast:T}}),y()!=="uiMessageCode sent"&&(a=r.fill?"fill":"stroke",d({messageType:"newColorsRgba",messageData:{colorsRgba:r,currentFillOrStroke:a}}))},O=()=>{y()!=="uiMessageCode sent"&&(a=r.fill?"fill":"stroke",d({messageType:"newColorsRgba",messageData:{colorsRgba:r,currentFillOrStroke:a}}))},M=e=>{if(m||e.documentChanges[0].type!=="PROPERTY_CHANGE")return;const o=e.documentChanges[0].properties[0];if(_.includes(o)){const l=JSON.parse(JSON.stringify(r));if(y()==="uiMessageCode sent")return;JSON.stringify(l)!==JSON.stringify(r)&&(a==="fill"&&!r.fill?a="stroke":a==="stroke"&&!r.stroke&&(a="fill")),d({messageType:"newColorsRgba",messageData:{colorsRgba:r,currentFillOrStroke:a}})}};figma.on("selectionchange",O);figma.on("documentchange",M);figma.on("close",()=>{figma.off("selectionchange",O),figma.off("documentchange",M)});let h;figma.ui.onmessage=e=>{switch(e.message){case"init":N();break;case"updateShapeColor":m=!0,E(e.newColorRgba,a,e.updateParent),h&&clearTimeout(h),h=setTimeout(()=>{m=!1},500);break;case"syncFileColorProfile":figma.clientStorage.setAsync("fileColorProfile",e.fileColorProfile);break;case"syncCurrentFillOrStroke":a=e.currentFillOrStroke;break;case"syncCurrentColorModel":f=e.currentColorModel,b(),figma.clientStorage.setAsync("currentColorModel",e.currentColorModel);break;case"syncShowCssColorCodes":g=e.showCssColorCodes,b(),figma.clientStorage.setAsync("showCssColorCodes",g);break;case"syncLockRelativeChromaWithPlugin":figma.clientStorage.setAsync("lockRelativeChroma",e.lockRelativeChroma);break;case"syncLockContrastWithPlugin":figma.clientStorage.setAsync("lockContrast",e.lockContrast);break}};
