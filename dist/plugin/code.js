"use strict";let i="fill",u,n,S,a;const t={okHsvlWithoutColorCodes:436,okHsvlWithColorCodes:564,okLchWithoutColorCodes:469,okLchWithColorCodes:598};let h=!1;const l={fill:null,stroke:null},R=["BOOLEAN_OPERATION","COMPONENT","ELLIPSE","FRAME","INSTANCE","LINE","POLYGON","RECTANGLE","STAR","TEXT","VECTOR","SHAPE_WITH_TEXT","HIGHLIGHT"],E=["fills","fillStyleId","strokes","strokeWeight"],k=()=>{a?["oklch","oklchCss"].includes(n)?figma.ui.resize(240,t.okLchWithColorCodes):figma.ui.resize(240,t.okHsvlWithColorCodes):["oklch","oklchCss"].includes(n)?figma.ui.resize(240,t.okLchWithoutColorCodes):figma.ui.resize(240,t.okHsvlWithoutColorCodes)},d=()=>{var r,f;const o=figma.currentPage.selection;if(!o[0])return g("no_selection"),!1;for(const c of o)if(!R.includes(c.type))return g("not_supported_type",c.type),!1;const s=o[0].fills[0],e=o[0].strokes[0];if(!s&&!e)return g("no_color_in_shape"),!1;if((s==null?void 0:s.type)!=="SOLID"&&(e==null?void 0:e.type)!=="SOLID")return g("no_solid_color"),!1;if((s==null?void 0:s.type)==="SOLID"?l.fill={r:s.color.r*255,g:s.color.g*255,b:s.color.b*255,a:Math.round(s.opacity*100)}:l.fill=null,(e==null?void 0:e.type)==="SOLID"?l.stroke={r:e.color.r*255,g:e.color.g*255,b:e.color.b*255,a:Math.round(e.opacity*100)}:l.stroke=null,o.length>1){let c=0,y=0;for(const p of o)((r=p.fills[0])==null?void 0:r.type)==="SOLID"&&c++,((f=p.strokes[0])==null?void 0:f.type)==="SOLID"&&y++;if(o.length!==c&&o.length!==y)return g("not_all_shapes_have_fill_or_stroke"),!1}return!0},I=()=>{figma.ui.postMessage({message:"init",initData:{figmaEditorType:figma.editorType,fileColorProfile:u,currentColorModel:n,lockRelativeChroma:S,showCssColorCodes:a}})},m=()=>{figma.ui.postMessage({message:"newColorsRgba",newColorsRgbaData:{colorsRgba:l,currentFillOrStroke:i}})},g=(o,s)=>{figma.ui.postMessage({message:"displayUiMessage",displayUiMessageData:{uiMessageCode:o,nodeType:s}})};figma.on("selectionchange",()=>{d()&&(i=l.fill?"fill":"stroke",m())});figma.on("documentchange",o=>{if(h)return;if(o.documentChanges[0].type==="PROPERTY_CHANGE"){const e=o.documentChanges[0].properties[0];if(E.includes(e)){const r=JSON.parse(JSON.stringify(l));if(!d())return;JSON.stringify(r)!==JSON.stringify(l)&&(i==="fill"&&!l.fill?i="stroke":i==="stroke"&&!l.stroke&&(i="fill")),m()}}});let C;figma.ui.onmessage=o=>{if(o.message==="init")T();else if(o.message==="updateShapeColor"){h=!0;const s={r:o.newColorRgba.r/255,g:o.newColorRgba.g/255,b:o.newColorRgba.b/255,a:o.newColorRgba.a/100};let e;const r=i+"s";for(const f of figma.currentPage.selection)e=JSON.parse(JSON.stringify(f[r])),e[0].color.r=s.r,e[0].color.g=s.g,e[0].color.b=s.b,e[0].opacity=s.a,f[r]=e;C&&clearTimeout(C),C=setTimeout(()=>{h=!1},500)}else o.message==="syncFileColorProfile"?figma.clientStorage.setAsync("fileColorProfile",o.fileColorProfile):o.message==="syncCurrentFillOrStroke"?i=o.currentFillOrStroke:o.message==="syncCurrentColorModel"?(n=o.currentColorModel,k(),figma.clientStorage.setAsync("currentColorModel",o.currentColorModel)):o.message==="syncShowCssColorCodes"?(a=o.showCssColorCodes,k(),figma.clientStorage.setAsync("showCssColorCodes",a)):o.message==="syncLockRelativeChromaWithPlugin"&&figma.clientStorage.setAsync("lockRelativeChroma",o.lockRelativeChroma)};const _=async()=>{figma.editorType==="figma"?u=await figma.clientStorage.getAsync("fileColorProfile")||"rgb":figma.editorType==="figjam"&&(u="rgb"),n=await figma.clientStorage.getAsync("currentColorModel")||"oklchCss",S=await figma.clientStorage.getAsync("lockRelativeChroma")||!1,a=await figma.clientStorage.getAsync("showCssColorCodes")||!1;let o=a?t.okLchWithColorCodes:t.okLchWithoutColorCodes;["okhsv","okhsl"].includes(n)&&(o=a?t.okHsvlWithColorCodes:t.okHsvlWithoutColorCodes),figma.showUI(__html__,{width:240,height:o,themeColors:!0})};_();const T=async()=>{I(),d()&&(i=l.fill?"fill":"stroke",m())};
