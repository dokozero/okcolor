"use strict";const _=["BOOLEAN_OPERATION","COMPONENT","ELLIPSE","FRAME","INSTANCE","LINE","POLYGON","RECTANGLE","STAR","TEXT","VECTOR","SHAPE_WITH_TEXT","HIGHLIGHT"];function E(){var h,y,d,n;const o=figma.currentPage.selection,e={newColorsRgba:{parentFill:null,fill:null,stroke:null},uiMessageCode:null,nodeType:null};if(!o[0])return e.uiMessageCode="no_selection",e;for(const r of o)if(!_.includes(r.type))return e.uiMessageCode="not_supported_type",e.nodeType=r.type,e;const l=o[0],s=l.fills[0],t=l.strokes[0];if(!s&&!t)return e.uiMessageCode="no_color_in_shape",e;if((s==null?void 0:s.type)!=="SOLID"&&(t==null?void 0:t.type)!=="SOLID")return e.uiMessageCode="no_solid_color",e;if((s==null?void 0:s.type)==="SOLID"&&(e.newColorsRgba.fill={r:s.color.r*255,g:s.color.g*255,b:s.color.b*255,a:Math.round(s.opacity*100)}),(t==null?void 0:t.type)==="SOLID"&&(e.newColorsRgba.stroke={r:t.color.r*255,g:t.color.g*255,b:t.color.b*255,a:Math.round(t.opacity*100)}),(h=l.parent)!=null&&h.fills){let r=l.parent;for(;r;)if(r.fills&&((y=r==null?void 0:r.fills)==null?void 0:y.length)!==0){e.newColorsRgba.parentFill={r:r.fills[0].color.r*255,g:r.fills[0].color.g*255,b:r.fills[0].color.b*255};break}else if(r.parent)r=r.parent;else break}if(o.length>1){e.newColorsRgba.parentFill&&(e.newColorsRgba.parentFill=null);let r=0,A=0;for(const N of o)((d=N.fills[0])==null?void 0:d.type)==="SOLID"&&r++,((n=N.strokes[0])==null?void 0:n.type)==="SOLID"&&A++;if(o.length!==r&&o.length!==A)return e.uiMessageCode="not_all_shapes_have_fill_or_stroke",e}return e}const c={okhsvl:{colorCodes:564,noColorCodes:435},oklch:{contrastAndColorCodes:680,contrastAndNoColorCodes:550,noContrastAndColorCodes:647,noContrastAndNoColorCodes:517}};function w(o){const{currentColorModel:e,isColorCodeInputsOpen:l,isContrastInputOpen:s}=o;return["okhsv","okhsl"].includes(e)?l?c.okhsvl.colorCodes:c.okhsvl.noColorCodes:["oklch","oklchCss"].includes(e)?s?l?c.oklch.contrastAndColorCodes:c.oklch.contrastAndNoColorCodes:l?c.oklch.noContrastAndColorCodes:c.oklch.noContrastAndNoColorCodes:c.oklch.contrastAndColorCodes}function k(o){figma.ui.postMessage({type:o.type,data:o.data})}function P(o,e,l){var y;const s={r:o.r/255,g:o.g/255,b:o.b/255,a:o.a/100};let t;const h=e+"s";for(const d of figma.currentPage.selection){let n;if(l==="bg"){for(n=d.parent;n&&((y=n.fills)==null?void 0:y.length)===0;)if(n.parent)n=n.parent;else break;t=JSON.parse(JSON.stringify(n.fills))}else t=JSON.parse(JSON.stringify(d[h]));t[0].color.r=s.r,t[0].color.g=s.g,t[0].color.b=s.b,t[0].opacity=s.a,l==="bg"?n.fills=t:d[h]=t}}let a="fill",m,g,u,f,I,C,p,b=!1,i={parentFill:null,fill:null,stroke:null};const L=["fills","fillStyleId","strokes","strokeStyleId","strokeWeight","textStyleId"],S=()=>{const o=w({currentColorModel:g,isColorCodeInputsOpen:p,isContrastInputOpen:u});figma.ui.resize(240,o)},M=()=>{const o=E();return o.uiMessageCode?(k({type:"displayUiMessage",data:{uiMessageCode:o.uiMessageCode,nodeType:o.nodeType}}),"uiMessageCode sent"):(i=JSON.parse(JSON.stringify(o.newColorsRgba)),"colorsRgba updated")},H=async()=>{figma.editorType==="figma"?m=await figma.clientStorage.getAsync("fileColorProfile")||"rgb":figma.editorType==="figjam"&&(m="rgb"),u=await figma.clientStorage.getAsync("isContrastInputOpen")||!1,p=await figma.clientStorage.getAsync("isColorCodeInputsOpen")||!1,I=await figma.clientStorage.getAsync("currentContrastMethod")||"apca",g=await figma.clientStorage.getAsync("currentColorModel")||"oklchCss",g==="okhsv"||g==="okhsl"?(f=!1,C=!1):(f=await figma.clientStorage.getAsync("lockRelativeChroma")||!1,C=await figma.clientStorage.getAsync("lockContrast")||!1);const o=w({currentColorModel:g,isColorCodeInputsOpen:p,isContrastInputOpen:u});figma.showUI(__html__,{width:240,height:o,themeColors:!0})};H();const F=async()=>{k({type:"syncLocalStorageValues",data:{figmaEditorType:figma.editorType,fileColorProfile:m,isContrastInputOpen:u,lockRelativeChroma:f,currentContrastMethod:I,lockContrast:C,isColorCodeInputsOpen:p,currentColorModel:g}}),M()!=="uiMessageCode sent"&&(a=i.fill?"fill":"stroke",k({type:"syncNewShape",data:{currentFillOrStroke:a,colorsRgba:i,lockRelativeChroma:f,lockContrast:C}}))},R=()=>{M()!=="uiMessageCode sent"&&(a=i.fill?"fill":"stroke",k({type:"syncNewShape",data:{currentFillOrStroke:a,colorsRgba:i,lockRelativeChroma:f,lockContrast:C}}))},T=o=>{if(b||o.documentChanges[0].type!=="PROPERTY_CHANGE")return;if(o.documentChanges[0].properties.some(l=>L.includes(l))){const l=JSON.parse(JSON.stringify(i));if(M()==="uiMessageCode sent")return;JSON.stringify(l)!==JSON.stringify(i)&&(a==="fill"&&!i.fill?a="stroke":a==="stroke"&&!i.stroke&&(a="fill")),k({type:"syncNewShape",data:{currentFillOrStroke:a,colorsRgba:i,lockRelativeChroma:f,lockContrast:C}})}};figma.on("selectionchange",R);figma.on("documentchange",T);figma.on("close",()=>{figma.off("selectionchange",R),figma.off("documentchange",T)});let O;figma.ui.onmessage=o=>{let e;switch(o.type){case"triggerInit":F();break;case"updateShapeColor":e=o.data,b=!0,P(e.newColorRgba,a,e.currentBgOrFg),O&&clearTimeout(O),O=setTimeout(()=>{b=!1},500);break;case"syncFileColorProfile":e=o.data,m=e.fileColorProfile,figma.clientStorage.setAsync("fileColorProfile",e.fileColorProfile);break;case"syncCurrentFillOrStroke":e=o.data,a=e.currentFillOrStroke;break;case"syncCurrentColorModel":e=o.data,g=e.currentColorModel,figma.clientStorage.setAsync("currentColorModel",e.currentColorModel),S();break;case"syncIsContrastInputOpen":e=o.data,u=e.isContrastInputOpen,figma.clientStorage.setAsync("isContrastInputOpen",u),S();break;case"syncLockRelativeChroma":e=o.data,f=e.lockRelativeChroma,figma.clientStorage.setAsync("lockRelativeChroma",e.lockRelativeChroma);break;case"syncCurrentContrastMethod":e=o.data,I=e.currentContrastMethod,figma.clientStorage.setAsync("currentContrastMethod",e.currentContrastMethod);break;case"syncLockContrast":e=o.data,C=e.lockContrast,figma.clientStorage.setAsync("lockContrast",e.lockContrast);break;case"syncIsColorCodeInputsOpen":e=o.data,p=e.isColorCodeInputsOpen,figma.clientStorage.setAsync("isColorCodeInputsOpen",p),S();break}};
