"use strict";const T=["BOOLEAN_OPERATION","COMPONENT","ELLIPSE","FRAME","INSTANCE","LINE","POLYGON","RECTANGLE","STAR","TEXT","VECTOR","SHAPE_WITH_TEXT","HIGHLIGHT"];function _(){var d,u,C,i;const o=figma.currentPage.selection,e={newColorsRgba:{parentFill:null,fill:null,stroke:null},uiMessageCode:null,nodeType:null};if(!o[0])return e.uiMessageCode="no_selection",e;for(const l of o)if(!T.includes(l.type))return e.uiMessageCode="not_supported_type",e.nodeType=l.type,e;const r=o[0],s=r.fills[0],t=r.strokes[0];if(!s&&!t)return e.uiMessageCode="no_color_in_shape",e;if((s==null?void 0:s.type)!=="SOLID"&&(t==null?void 0:t.type)!=="SOLID")return e.uiMessageCode="no_solid_color",e;if((s==null?void 0:s.type)==="SOLID"&&(e.newColorsRgba.fill={r:s.color.r*255,g:s.color.g*255,b:s.color.b*255,a:Math.round(s.opacity*100)}),(t==null?void 0:t.type)==="SOLID"&&(e.newColorsRgba.stroke={r:t.color.r*255,g:t.color.g*255,b:t.color.b*255,a:Math.round(t.opacity*100)}),(d=r.parent)!=null&&d.fills){let l=r.parent;for(;l;)if(l.fills&&((u=l==null?void 0:l.fills)==null?void 0:u.length)!==0){e.newColorsRgba.parentFill={r:l.fills[0].color.r*255,g:l.fills[0].color.g*255,b:l.fills[0].color.b*255};break}else if(l.parent)l=l.parent;else break}if(o.length>1){e.newColorsRgba.parentFill&&(e.newColorsRgba.parentFill=null);let l=0,b=0;for(const I of o)((C=I.fills[0])==null?void 0:C.type)==="SOLID"&&l++,((i=I.strokes[0])==null?void 0:i.type)==="SOLID"&&b++;if(o.length!==l&&o.length!==b)return e.uiMessageCode="not_all_shapes_have_fill_or_stroke",e}return e}function p(o){figma.ui.postMessage({type:o.type,data:o.data})}function A(o,e,r){var u;const s={r:o.r/255,g:o.g/255,b:o.b/255,a:o.a/100};let t;const d=e+"s";for(const C of figma.currentPage.selection){let i;if(r){for(i=C.parent;i&&((u=i.fills)==null?void 0:u.length)===0;)if(i.parent)i=i.parent;else break;t=JSON.parse(JSON.stringify(i.fills))}else t=JSON.parse(JSON.stringify(C[d]));t[0].color.r=s.r,t[0].color.g=s.g,t[0].color.b=s.b,t[0].opacity=s.a,r?i.fills=t:C[d]=t}}let a="fill",y,c,g,k,m;const f={okHsvlWithoutColorCodes:435,okHsvlWithColorCodes:564,okLchWithoutColorCodes:503,okLchWithColorCodes:632};let S=!1,n={parentFill:null,fill:null,stroke:null};const L=["fills","fillStyleId","strokes","strokeStyleId","strokeWeight","textStyleId"],R=()=>{g?["oklch","oklchCss"].includes(c)?figma.ui.resize(240,f.okLchWithColorCodes):figma.ui.resize(240,f.okHsvlWithColorCodes):["oklch","oklchCss"].includes(c)?figma.ui.resize(240,f.okLchWithoutColorCodes):figma.ui.resize(240,f.okHsvlWithoutColorCodes)},O=()=>{const o=_();return o.uiMessageCode?(p({type:"displayUiMessage",data:{uiMessageCode:o.uiMessageCode,nodeType:o.nodeType}}),"uiMessageCode sent"):(n=JSON.parse(JSON.stringify(o.newColorsRgba)),"colorsRgba updated")},N=async()=>{figma.editorType==="figma"?y=await figma.clientStorage.getAsync("fileColorProfile")||"rgb":figma.editorType==="figjam"&&(y="rgb"),c=await figma.clientStorage.getAsync("currentColorModel")||"oklchCss",g=await figma.clientStorage.getAsync("isColorCodeInputsOpen")||!1,c==="okhsv"||c==="okhsl"?(k=!1,m=!1):(k=await figma.clientStorage.getAsync("lockRelativeChroma")||!1,m=await figma.clientStorage.getAsync("lockContrast")||!1);let o=g?f.okLchWithColorCodes:f.okLchWithoutColorCodes;["okhsv","okhsl"].includes(c)&&(o=g?f.okHsvlWithColorCodes:f.okHsvlWithoutColorCodes),figma.showUI(__html__,{width:240,height:o,themeColors:!0})};N();const P=async()=>{p({type:"syncLocalStorageValues",data:{figmaEditorType:figma.editorType,fileColorProfile:y,currentColorModel:c,isColorCodeInputsOpen:g,lockRelativeChroma:k,lockContrast:m}}),O()!=="uiMessageCode sent"&&(a=n.fill?"fill":"stroke",p({type:"syncCurrentFillOrStrokeAndColorsRgba",data:{currentFillOrStroke:a,colorsRgba:n}}))},E=()=>{O()!=="uiMessageCode sent"&&(a=n.fill?"fill":"stroke",p({type:"syncCurrentFillOrStrokeAndColorsRgba",data:{currentFillOrStroke:a,colorsRgba:n}}))},M=o=>{if(S||o.documentChanges[0].type!=="PROPERTY_CHANGE")return;if(o.documentChanges[0].properties.some(r=>L.includes(r))){const r=JSON.parse(JSON.stringify(n));if(O()==="uiMessageCode sent")return;JSON.stringify(r)!==JSON.stringify(n)&&(a==="fill"&&!n.fill?a="stroke":a==="stroke"&&!n.stroke&&(a="fill")),p({type:"syncCurrentFillOrStrokeAndColorsRgba",data:{currentFillOrStroke:a,colorsRgba:n}})}};figma.on("selectionchange",E);figma.on("documentchange",M);figma.on("close",()=>{figma.off("selectionchange",E),figma.off("documentchange",M)});let h;figma.ui.onmessage=o=>{let e;switch(o.type){case"triggerInit":P();break;case"updateShapeColor":e=o.data,S=!0,A(e.newColorRgba,a,e.updateParent),h&&clearTimeout(h),h=setTimeout(()=>{S=!1},500);break;case"syncFileColorProfile":e=o.data,figma.clientStorage.setAsync("fileColorProfile",e.fileColorProfile);break;case"syncCurrentFillOrStroke":e=o.data,a=e.currentFillOrStroke;break;case"syncCurrentColorModel":e=o.data,c=e.currentColorModel,R(),figma.clientStorage.setAsync("currentColorModel",e.currentColorModel);break;case"syncIsColorCodeInputsOpen":e=o.data,g=e.isColorCodeInputsOpen,R(),figma.clientStorage.setAsync("isColorCodeInputsOpen",g);break;case"syncLockRelativeChroma":e=o.data,figma.clientStorage.setAsync("lockRelativeChroma",e.lockRelativeChroma);break;case"syncLockContrast":e=o.data,figma.clientStorage.setAsync("lockContrast",e.lockContrast);break}};
