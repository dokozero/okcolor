"use strict";const P=["BOOLEAN_OPERATION","COMPONENT","ELLIPSE","FRAME","INSTANCE","LINE","POLYGON","RECTANGLE","STAR","TEXT","VECTOR","SHAPE_WITH_TEXT","HIGHLIGHT"];function L(){var a,M,N,T;const o=figma.currentPage.selection,e={newColorsRgba:{parentFill:null,fill:null,stroke:null},uiMessageCode:null,nodeType:null};let r=!0,n=!0;if(!o[0])return e.uiMessageCode="no_selection",e;for(const t of o)if(!P.includes(t.type))return e.uiMessageCode="not_supported_type",e.nodeType=t.type,e;const f=o[0],l=f.fills[0],s=f.strokes[0];if(!l&&!s)return e.uiMessageCode="no_color_in_shape",e;if((l==null?void 0:l.type)!=="SOLID"&&(s==null?void 0:s.type)!=="SOLID")return e.uiMessageCode="no_solid_color",e;if((a=f.parent)!=null&&a.fills){let t=f.parent;for(;t;)if(t.fills&&((M=t==null?void 0:t.fills)==null?void 0:M.length)!==0){e.newColorsRgba.parentFill={r:t.fills[0].color.r,g:t.fills[0].color.g,b:t.fills[0].color.b};break}else if(t.parent)t=t.parent;else break}if(o.length>1){e.newColorsRgba.parentFill&&(e.newColorsRgba.parentFill=null);let t=0,S=0;for(const w of o)((N=w.fills[0])==null?void 0:N.type)==="SOLID"&&t++,((T=w.strokes[0])==null?void 0:T.type)==="SOLID"&&S++;if(o.length!==t&&o.length!==S)return e.uiMessageCode="not_all_shapes_have_fill_or_stroke",e;o.length!==t?r=!1:o.length!==S&&(n=!1)}return(l==null?void 0:l.type)==="SOLID"&&r&&(e.newColorsRgba.fill={r:l.color.r,g:l.color.g,b:l.color.b,a:l.opacity}),(s==null?void 0:s.type)==="SOLID"&&n&&(e.newColorsRgba.stroke={r:s.color.r,g:s.color.g,b:s.color.b,a:s.opacity}),e}const g={okhsvl:{colorCodes:564,noColorCodes:435},oklch:{contrastAndColorCodes:680,contrastAndNoColorCodes:550,noContrastAndColorCodes:647,noContrastAndNoColorCodes:517}};function R(o){const{currentColorModel:e,isColorCodeInputsOpen:r,isContrastInputOpen:n}=o;return["okhsv","okhsl"].includes(e)?r?g.okhsvl.colorCodes:g.okhsvl.noColorCodes:["oklch","oklchCss"].includes(e)?n?r?g.oklch.contrastAndColorCodes:g.oklch.contrastAndNoColorCodes:r?g.oklch.noContrastAndColorCodes:g.oklch.noContrastAndNoColorCodes:g.oklch.contrastAndColorCodes}function y(o){figma.ui.postMessage({type:o.type,data:o.data})}function H(o,e,r){var l;let n;const f=e+"s";for(const s of figma.currentPage.selection){let a;if(r==="bg"){for(a=s.parent;a&&((l=a.fills)==null?void 0:l.length)===0;)if(a.parent)a=a.parent;else break;n=JSON.parse(JSON.stringify(a.fills))}else n=JSON.parse(JSON.stringify(s[f]));n[0].color.r=o.r,n[0].color.g=o.g,n[0].color.b=o.b,n[0].opacity=o.a,r==="bg"?a.fills=n:s[f]=n}}let i="fill",k,C,p,d,b,u,h,I=!1,c={parentFill:null,fill:null,stroke:null};const F=["fills","fillStyleId","strokes","strokeStyleId","strokeWeight","textStyleId"],m=()=>{const o=R({currentColorModel:C,isColorCodeInputsOpen:h,isContrastInputOpen:p});figma.ui.resize(240,o)},A=()=>{const o=L();return o.uiMessageCode?(y({type:"displayUiMessage",data:{uiMessageCode:o.uiMessageCode,nodeType:o.nodeType}}),"uiMessageCode sent"):(c=JSON.parse(JSON.stringify(o.newColorsRgba)),"colorsRgba updated")},J=async()=>{figma.editorType==="figma"?k=await figma.clientStorage.getAsync("fileColorProfile")||"rgb":figma.editorType==="figjam"&&(k="rgb"),p=await figma.clientStorage.getAsync("isContrastInputOpen")||!1,h=await figma.clientStorage.getAsync("isColorCodeInputsOpen")||!1,b=await figma.clientStorage.getAsync("currentContrastMethod")||"apca",C=await figma.clientStorage.getAsync("currentColorModel")||"oklchCss",C==="okhsv"||C==="okhsl"?(d=!1,u=!1):(d=await figma.clientStorage.getAsync("lockRelativeChroma")||!1,u=await figma.clientStorage.getAsync("lockContrast")||!1);const o=R({currentColorModel:C,isColorCodeInputsOpen:h,isContrastInputOpen:p});figma.showUI(__html__,{width:240,height:o,themeColors:!0})};J();const D=async()=>{y({type:"syncLocalStorageValues",data:{figmaEditorType:figma.editorType,fileColorProfile:k,isContrastInputOpen:p,lockRelativeChroma:d,currentContrastMethod:b,lockContrast:u,isColorCodeInputsOpen:h,currentColorModel:C}}),A()!=="uiMessageCode sent"&&(i=c.fill?"fill":"stroke",y({type:"syncNewShape",data:{currentFillOrStroke:i,colorsRgba:c,lockRelativeChroma:d,lockContrast:u}}))},_=()=>{A()!=="uiMessageCode sent"&&(i=c.fill?"fill":"stroke",y({type:"syncNewShape",data:{currentFillOrStroke:i,colorsRgba:c,lockRelativeChroma:d,lockContrast:u}}))},E=o=>{if(I||o.documentChanges[0].type!=="PROPERTY_CHANGE")return;if(o.documentChanges[0].properties.some(r=>F.includes(r))){const r=JSON.parse(JSON.stringify(c));if(A()==="uiMessageCode sent")return;JSON.stringify(r)!==JSON.stringify(c)&&(i==="fill"&&!c.fill?i="stroke":i==="stroke"&&!c.stroke&&(i="fill")),y({type:"syncNewShape",data:{currentFillOrStroke:i,colorsRgba:c,lockRelativeChroma:d,lockContrast:u}})}};figma.on("selectionchange",_);figma.on("documentchange",E);figma.on("close",()=>{figma.off("selectionchange",_),figma.off("documentchange",E)});let O;figma.ui.onmessage=o=>{let e;switch(o.type){case"triggerInit":D();break;case"updateShapeColor":e=o.data,I=!0,H(e.newColorRgba,i,e.currentBgOrFg),O&&clearTimeout(O),O=setTimeout(()=>{I=!1},500);break;case"syncFileColorProfile":e=o.data,k=e.fileColorProfile,figma.clientStorage.setAsync("fileColorProfile",e.fileColorProfile);break;case"syncCurrentFillOrStroke":e=o.data,i=e.currentFillOrStroke;break;case"syncCurrentColorModel":e=o.data,C=e.currentColorModel,figma.clientStorage.setAsync("currentColorModel",e.currentColorModel),m();break;case"syncIsContrastInputOpen":e=o.data,p=e.isContrastInputOpen,figma.clientStorage.setAsync("isContrastInputOpen",p),m();break;case"syncLockRelativeChroma":e=o.data,d=e.lockRelativeChroma,figma.clientStorage.setAsync("lockRelativeChroma",e.lockRelativeChroma);break;case"syncCurrentContrastMethod":e=o.data,b=e.currentContrastMethod,figma.clientStorage.setAsync("currentContrastMethod",e.currentContrastMethod);break;case"syncLockContrast":e=o.data,u=e.lockContrast,figma.clientStorage.setAsync("lockContrast",e.lockContrast);break;case"syncIsColorCodeInputsOpen":e=o.data,h=e.isColorCodeInputsOpen,figma.clientStorage.setAsync("isColorCodeInputsOpen",h),m();break}};
